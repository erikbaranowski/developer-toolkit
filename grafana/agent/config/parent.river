/********************************************
 * METRICS
 ********************************************/
local.file "metrics" {
	filename = env("AGENT_CONFIG_FOLDER") + "/metrics/metrics.river"
}

module.string "metrics" {
	content   = local.file.metrics.content
	arguments = {
		prometheus_exporter_unix_targets = prometheus.exporter.unix.targets,
	}
}

// This is a singleton which is not allowed inside a module so it must be
// passed in as an argument to module.string.metrics above.
prometheus.exporter.unix { }

/********************************************
 * AGENT LOGGING
 ********************************************/
logging {
	level  = env("AGENT_LOG_LEVEL")
	format = "logfmt"
}

local.file "logs" {
	filename = env("AGENT_CONFIG_FOLDER") + "/logs/logs.river"
}

module.string "logs" {
	content = local.file.logs.content
}

/********************************************
 * AGENT TRACING
 ********************************************/
tracing {
	sampling_fraction = 1
	write_to          = [module.string.traces.exports.otelcolprocessorbatch]
}

local.file "traces" {
	filename = env("AGENT_CONFIG_FOLDER") + "/traces/traces.river"
}

module.string "traces" {
	content = local.file.traces.content
}
